#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ðŸš€ Running pre-commit checks..."

# Lint and format code
echo "ðŸ” Running ESLint..."
npm run lint --if-present

# Check TypeScript compilation
echo "ðŸ”§ Checking TypeScript compilation..."
npm run build --if-present

# Run unit tests
echo "ðŸ§ª Running unit tests..."
npm run test --if-present

# Check for security vulnerabilities
echo "ðŸ”’ Checking for security vulnerabilities..."
npm audit --audit-level moderate

# Verify environment files
echo "ðŸ“‹ Verifying environment configuration..."
if [ ! -f ".env" ]; then
  echo "âš ï¸  Warning: .env file not found"
fi

if [ ! -f "config/env.example" ]; then
  echo "âš ï¸  Warning: config/env.example file not found"
fi

# Check Docker configuration
echo "ðŸ³ Validating Docker configuration..."
docker compose -f infrastructure/docker/docker-compose.yml config > /dev/null

echo "âœ… Pre-commit checks completed!"
