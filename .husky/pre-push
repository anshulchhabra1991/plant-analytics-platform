#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."

# Run integration tests
echo "ğŸ§ª Running integration tests..."
npm run test:integration --if-present

# Run e2e tests
echo "ğŸ¯ Running end-to-end tests..."
npm run test:e2e --if-present

# Verify services health
echo "ğŸ¥ Running health checks..."
npm run health --if-present

# Check for breaking changes in API
echo "ğŸ” Checking for API breaking changes..."
# This could integrate with API versioning tools

# Verify data pipeline
echo "ğŸ“Š Verifying data pipeline..."
if command -v python3 &> /dev/null; then
  python3 scripts/verify-pipeline.py --if-present 2>/dev/null || echo "âš ï¸  Pipeline verification skipped"
fi

# Security scan
echo "ğŸ”’ Running security scan..."
npm audit --audit-level high

echo "âœ… Pre-push checks completed!" 